{"generator":"Code Snippets v2.14.3","date_created":"2022-05-10 21:36","snippets":[{"name":"Admin - Filter by Date Range","desc":"&nbsp;\n\n<img id=\"floatBarImgId\" style=\"display: none; opacity: 0; position: absolute; z-index: 2147483647;\" src=\"chrome-extension:\/\/dbkmjjclgbiooljcegcddagnddjedmed\/pics\/save2-32.png\" \/>","scope":"global","code":"class mishaDateRange{\n\n\tfunction __construct(){\n\t\n\t\t\/\/ if you do not want to remove default \"by month filter\", remove\/comment this line\n\t\tadd_filter( 'months_dropdown_results', '__return_empty_array' );\n\t\t\n\t\t\/\/ include CSS\/JS, in our case jQuery UI datepicker\n\t\tadd_action( 'admin_enqueue_scripts', array( $this, 'jqueryui' ) );\n\t\t\n\t\t\/\/ HTML of the filter\n\t\tadd_action( 'restrict_manage_posts', array( $this, 'form' ) );\n\t\t\n\t\t\/\/ the function that filters posts\n\t\tadd_action( 'pre_get_posts', array( $this, 'filterquery' ) );\n\t\t\n\t}\n\n\t\/*\n\t * Add jQuery UI CSS and the datepicker script\n\t * Everything else should be already included in \/wp-admin\/ like jquery, jquery-ui-core etc\n\t * If you use WooCommerce, you can skip this function completely\n\t *\/\n\tfunction jqueryui(){\n\t\twp_enqueue_style( 'jquery-ui', '\/\/code.jquery.com\/ui\/1.11.4\/themes\/smoothness\/jquery-ui.min.css' );\n\t\twp_enqueue_script( 'jquery-ui-datepicker' );\n\t}\n\n\t\/*\n\t * Two input fields with CSS\/JS\n\t * If you would like to move CSS and JavaScript to the external file - welcome.\n\t *\/\n\tfunction form(){\n\t\t\n\t\t$from = ( isset( $_GET['mishaDateFrom'] ) && $_GET['mishaDateFrom'] ) ? $_GET['mishaDateFrom'] : '';\n\t\t$to = ( isset( $_GET['mishaDateTo'] ) && $_GET['mishaDateTo'] ) ? $_GET['mishaDateTo'] : '';\n\t\t\n\t\techo '<style>\n\t\tinput[name=\"mishaDateFrom\"], input[name=\"mishaDateTo\"]{\n\t\t\tline-height: 28px;\n\t\t\theight: 28px;\n\t\t\tmargin: 0;\n\t\t\twidth:125px;\n\t\t}\n\t\t<\/style>\n\t\t\n\t\t<input type=\"text\" name=\"mishaDateFrom\" placeholder=\"Date From\" value=\"' . esc_attr( $from ) . '\" \/>\n\t\t<input type=\"text\" name=\"mishaDateTo\" placeholder=\"Date To\" value=\"' . esc_attr( $to ) . '\" \/>\n\t\n\t\t<script>\n\t\tjQuery( function($) {\n\t\t\tvar from = $(\\'input[name=\"mishaDateFrom\"]\\'),\n\t\t\t    to = $(\\'input[name=\"mishaDateTo\"]\\');\n\n\t\t\t$( \\'input[name=\"mishaDateFrom\"], input[name=\"mishaDateTo\"]\\' ).datepicker( {dateFormat : \"yy-mm-dd\"} );\n\t\t\t\/\/ by default, the dates look like this \"April 3, 2017\"\n    \t\t\t\/\/ I decided to make it 2017-04-03 with this parameter datepicker({dateFormat : \"yy-mm-dd\"});\n    \n    \n    \t\t\t\/\/ the rest part of the script prevents from choosing incorrect date interval\n    \t\t\tfrom.on( \\'change\\', function() {\n\t\t\t\tto.datepicker( \\'option\\', \\'minDate\\', from.val() );\n\t\t\t});\n\t\t\t\t\n\t\t\tto.on( \\'change\\', function() {\n\t\t\t\tfrom.datepicker( \\'option\\', \\'maxDate\\', to.val() );\n\t\t\t});\n\t\t\t\n\t\t});\n\t\t<\/script>';\n\t\t\n\t}\n\t\n\t\/*\n\t * The main function that actually filters the posts\n\t *\/\n\tfunction filterquery( $admin_query ){\n\t\tglobal $pagenow;\n\t\t\n\t\tif (\n\t\t\tis_admin()\n\t\t\t&& $admin_query->is_main_query()\n\t\t\t\/\/ by default filter will be added to all post types, you can operate with $_GET['post_type'] to restrict it for some types\n\t\t\t&& in_array( $pagenow, array( 'edit.php', 'upload.php' ) )\n\t\t\t&& ( ! empty( $_GET['mishaDateFrom'] ) || ! empty( $_GET['mishaDateTo'] ) )\n\t\t) {\n\n\t\t\t$admin_query->set(\n\t\t\t\t'date_query', \/\/ I love date_query appeared in WordPress 3.7!\n\t\t\t\tarray(\n\t\t\t\t\t'after' => sanitize_text_field( $_GET['mishaDateFrom'] ), \/\/ any strtotime()-acceptable format!\n\t\t\t\t\t'before' => sanitize_text_field( $_GET['mishaDateTo'] ),\n\t\t\t\t\t'inclusive' => true, \/\/ include the selected days as well\n\t\t\t\t\t'column'    => 'post_date' \/\/ 'post_modified', 'post_date_gmt', 'post_modified_gmt'\n\t\t\t\t)\n\t\t\t);\n\t\t\t\n\t\t}\n\t\t\n\t\treturn $admin_query;\n\t\n\t}\n\n}\nnew mishaDateRange();","priority":"1"}]}